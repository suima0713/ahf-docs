# AHF TRI-4 v1.1 実装上の未解決問題

## 問題1: T1因果明瞭度（T）判定の精度

### 現状
- DUOLの実際のデータでは、QoQとYoYの説明が両方存在するが、T=1と判定されている
- 具体的には以下の説明が確認されている：
  - QoQ: "GM +130bps QoQ due to lower-than-expected AI costs and strength in ads"
  - YoY: "driven by increased generative AI costs year over year related to the expansion of the Duolingo Max"

### 問題
- 正規表現によるQoQ説明の検出が不完全
- キーワードマッチングが正確に動作していない
- 手動でT=2に設定しているが、自動判定として機能していない

### 必要な改善
- より柔軟な正規表現パターンの実装
- 文脈を考慮した因果関係検出
- QoQとYoYの説明の整合性チェック機能の強化

## 問題2: バリュエーション織込み度（V）の判定基準

### 現状
- TRI-4仕様では以下の基準：
  - Green: EV/Sales(Fwd) ≤ 10× and Rule-of-40 ≥ 40
  - Amber: 10×＜ EV/Sales(Fwd) ≤ 14× or Rule-of-40 ∈ [35,40)
  - Red: EV/Sales(Fwd) > 14× or Rule-of-40 < 35

### 問題
- DUOLの実際のデータ（EV/Sales(Fwd) ≈ 12×、Rule-of-40 ≈ 72%）では、Amber判定になっているが、Rule-of-40が72%と良好なのに割高判定になる論理的な疑問
- Rule-of-40が高い場合のV判定ロジックの再検討が必要

### 必要な改善
- Rule-of-40とEV/Sales(Fwd)の重み付け調整
- より複雑な判定ロジックの実装
- 業界特性を考慮した閾値設定

## 問題3: α3/α5ボーナス★判定の複雑性

### 現状
- α3: pp ≤ 0.2 かつ 残差 ≤ $8M
- α5: 中央値−実績 ≤ −$3M
- DUOLではα3 FAIL（pp=0.72 > 0.2）、α5 PASS（-$3.59M ≤ -$3M）

### 問題
- α3のpp閾値0.2が厳しすぎる可能性
- 残差金額とpp値のバランス調整が必要
- 業界特性を考慮した閾値設定の必要性

### 必要な改善
- 業界別の閾値設定
- pp値と残差金額の重み付け調整
- より柔軟な判定基準の実装

## 問題4: データ抽出の自動化

### 現状
- facts.mdからのデータ抽出が部分的に手動
- 正規表現による数値抽出が不完全
- 複数のデータソースからの情報統合が不十分

### 問題
- 手動設定に依存している部分が多い
- データの一貫性チェックが不十分
- エラーハンドリングが限定的

### 必要な改善
- より堅牢なデータ抽出ロジック
- データ品質チェック機能
- 自動化されたバリデーション機能

## 問題5: スケーラビリティと保守性

### 現状
- 各ティッカーごとに個別のスクリプトが必要
- 設定値のハードコーディング
- エラー処理の一貫性不足

### 問題
- 新しいティッカーの追加が困難
- 設定変更時の影響範囲が不明確
- デバッグとトラブルシューティングが複雑

### 必要な改善
- 設定ファイルベースのアーキテクチャ
- プラグイン形式の分析モジュール
- 統一されたエラーハンドリング

## 技術的な質問

1. **自然言語処理**: facts.mdからの因果関係抽出をより正確に行うには、どのようなNLP技術が適しているか？

2. **機械学習**: T、R、Vの判定を機械学習モデルで自動化することは可能か？どのような特徴量が有効か？

3. **データベース設計**: 複数ティッカーのデータを効率的に管理するためのデータベース設計はどうあるべきか？

4. **API設計**: 他のシステムとの連携を考慮したAPI設計のベストプラクティスは？

5. **テスト戦略**: 金融データの分析システムにおける包括的なテスト戦略はどう構築すべきか？

## 優先度

1. **高**: T1因果明瞭度判定の精度向上
2. **高**: バリュエーション織込み度判定ロジックの改善
3. **中**: α3/α5判定基準の柔軟化
4. **中**: データ抽出の自動化
5. **低**: スケーラビリティと保守性の改善

## 次のステップ

1. 自然言語処理技術の調査と実装
2. 判定ロジックの詳細な検証と調整
3. テストケースの拡充
4. 設定ファイルベースのアーキテクチャへの移行
5. ドキュメントの整備
