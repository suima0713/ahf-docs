# AHF銘柄分析システム - プロジェクト記憶

## プロジェクト概要
**Analytic Homeostasis（AHF）** - 軽さ最優先の銘柄分析システム
将来の **Harmonic Homeostasis（HH）** への進化を視野に入れた設計

## 合言葉
**Facts in, balance out.**

## システム設計思想

### AHF（現在運用）
- **軽さ最優先** - シンプルで高速な分析
- **30秒ループ** - 迅速な意思決定支援
- **土台重視** - ①②③マトリクスを恒常値として維持

### HH（将来目標）
- **ハーモニック** - 調和の取れた高度な分析
- **自動進化** - システムが自然に成長
- **反証強度** - より堅牢な分析結果

## Complexity Packing（枠内で複雑さを活かす5手順）

### 1. 原子化：事実を"1行"で取り込む
- **逐語** / **日付** / **出典（T1-F/P/C）** / **影響KPI（売上, GM, FCF, 在庫 等）** / **[Core] or [Time]**
- 解釈は後回し。まず粒を揃える。

### 2. 正規化＆重複排除
- 同趣旨は最新×強いT1だけ残す（両当事者＞自社＞コール）
- 矛盾T1はGateで停止し再検証

### 3. マッピング
- 原子を①右肩上がり／②傾きの質（ROIC−WACC・ROIIC・FCF/NI）／③時間へ配置
- ④は**〔Time〕注釈として③の文中に一度だけ**入れる（外付け係数は使わない）

### 4. 圧縮指標へ落とす
- 各Horizon（6M/1Y/3Y/5Y）で Δg（勾配差）／Δt（前倒し/遅延）／ΔIRR を記入
- ②の"質"は ROIIC−WACC を一本芯に

### 5. 決断（対角スイープ A→B→C）
- ①②が○で ΔIRR ≥ +300〜500bp → Go（サイズはσで調整）
- イベント未達・遅延・KPI逆行 → 〔Time〕を即ゼロ化して保守化

## ハイリスクを枠内で取るための3原則

### Primacy：①＞②＞③＞④
- ④は時間の注釈に限る

### Parsimony：出力は常に1ページ
- 差分1行＋Horizon＋KPI×2
- 複雑さは裏で圧縮

### Reversibility：価格ではなくT1とKPIで即巻き戻し
- 価格ではなくT1とKPIで即巻き戻せる形だけ取る

## 30秒ループ分析フレームワーク

### 1. T1分析（1行）
- **どこに効く？** - 影響範囲の特定
- **いつ？** - タイミングの把握  
- **も一言** - 簡潔な結論

### 2. マトリクス更新
- **①②③を一体** - 土台を外さない（恒常値）
- **④は〔Time〕注釈** - 時間の注釈に限定

### 3. Horizon更新
**6M/1Y/3Y/5Y：はい/△/いいえ** 形式で追跡

### 4. KPI監視
- **KPI×2だけ監視** - 外れたら即巻き戻し
- リバランスは差分1行＋KPI×2で十分

## HH昇格判定条件

### 手当てが減る
④〔Time〕注釈の出番が**全更新の≤20%**に自然低下

### 一貫性が増す  
ΔIRRが四半期を跨いでも符号が安定（±のブレが小さい）

### 反証に強い
C列（④無効化／t1+0.5Q）でも結論が維持されるケースが増える

## 実装済み機能

### コアシステム
- ✅ AHF分析エンジン（30秒ループ）
- ✅ ①②③マトリクスシステム
- ✅ Horizon追跡システム
- ✅ KPI監視システム
- ✅ HH進化判定システム

### Complexity Packing
- ✅ 原子化エンジン（1行事実取り込み）
- ✅ 正規化＆重複排除システム
- ✅ マッピングシステム（①②③配置）
- ✅ 圧縮指標システム（Δg/Δt/ΔIRR）
- ✅ 決断エンジン（対角スイープA→B→C）

### ハイリスク原則
- ✅ Primacy原則（①＞②＞③＞④）
- ✅ Parsimony原則（1ページ出力）
- ✅ Reversibility原則（T1とKPIで即巻き戻し）

### 分析テンプレート
- ✅ 1ページ分析レポート
- ✅ 圧縮分析レポート
- ✅ T1分析自動生成
- ✅ 時間注釈管理
- ✅ 進化サイン監視

### 実行環境
- ✅ メイン実行ファイル
- ✅ インタラクティブモード
- ✅ 圧縮分析モード
- ✅ 依存関係管理

## 運用方針

### 当面のフォーカス（AHFでやることだけ）
1. **①×②×③＝土台を外さない** - ここが"恒常値"
2. **④は時間の注釈に限定** - 外付け係数は使わない／二重計上しない
3. **リバランスは差分1行＋KPI×2で十分**

### 進化戦略
まずはAHFで回す習慣化 → 指標が自然と整ってきたらHHに昇格

### Complexity Packing戦略
- **複雑さは量ではなく"圧縮の質"で勝つ**
- AHFの枠に詰め込んで、リスク最大化しつつフレームアウト最小化
- 入力は3点だけ：逐語1行（T1）、どこに効く？（KPI名）、いつ？（四半期レンジ）

## 技術仕様

### プロジェクト構造
```
AHF/
├── core/                    # コア分析エンジン
│   ├── ahf_engine.py
│   ├── complexity_packing.py
│   └── high_risk_principles.py
├── matrix/                  # ①②③マトリクスシステム
├── horizon/                 # Horizon追跡システム
├── kpi/                    # KPI監視システム
├── evolution/              # HH昇格判定システム
│   └── hh_evolution.py
├── templates/              # 分析テンプレート
│   ├── analysis_template.py
│   └── compressed_analysis.py
├── main.py                # メイン実行ファイル
├── requirements.txt
└── README.md
```

### 主要クラス
- `AHFAnalysisEngine` - 30秒ループ分析エンジン
- `ComplexityPackingEngine` - 複雑さ圧縮エンジン
- `HighRiskPrinciplesEngine` - ハイリスク原則エンジン
- `HHEvolutionEngine` - HH進化判定エンジン
- `AHFStockAnalyzer` - 銘柄分析器（1ページ出力）
- `CompressedAnalysisEngine` - 圧縮分析器

## 次回起動時の継続方法

1. **プロジェクトディレクトリに移動**
   ```bash
   cd C:\Users\user\AHF
   ```

2. **基本分析実行**
   ```bash
   python main.py
   ```

3. **インタラクティブ分析**
   ```bash
   python main.py --interactive
   ```

4. **圧縮分析モード**
   - インタラクティブモードで 'compressed' を入力
   - 逐語1行（T1）、どこに効く？（KPI名）、いつ？（四半期レンジ）を入力

5. **新規銘柄分析**
   - インタラクティブモードで銘柄コード入力
   - または `templates/compressed_analysis.py` を直接使用

## 記憶事項
- 合言葉：「Facts in, balance out.」
- 複雑さは量ではなく"圧縮の質"で勝つ
- 軽さ最優先の設計思想
- 30秒ループの重要性
- ①②③マトリクスの恒常値としての役割
- Complexity Packingの5手順
- ハイリスク原則の3原則
- HH進化の3つの条件
- 1ページ分析レポートの標準化

## 今後の拡張予定
- 外部データソース連携
- リアルタイム市場データ取得
- 高度な可視化機能
- 機械学習による予測精度向上
- 複数銘柄同時分析
- ポートフォリオ最適化機能
- より高度な圧縮アルゴリズム
- リアルタイム巻き戻し機能